"use strict";var prevent_default=function(e){e.preventDefault()};function toggle_mark_complete(e){var t=jQuery(".llms-complete-lesson-form"),n=jQuery('.llms-complete-lesson-form button[type="submit"]'),o=jQuery("#llms_start_quiz, #llms-start-assignment");!0===e?(t.off("submit",prevent_default),n.removeAttr("disabled"),o.removeClass("llms-av-disabled").off("click",prevent_default)):(t.on("submit",prevent_default),n.attr("disabled","disabled"),o.addClass("llms-av-disabled").on("click",prevent_default))}var getEventMeta=function(e){return{ts:e.currentTime,duration:e.duration,url:e.source,provider:e.provider,id:e.config.id}},track_event=function(e,t){llms.tracking.addEvent("video."+e,{meta:t})};function start_countdown(e){var t,n=e.find(".llms-av-pv--seconds");setInterval((function(){1==(t=1*n.text()-1)&&n.closest("a")[0].click(),t>=0&&n.text(t)}),1e3)}function do_ajax_completion(e,t){LLMS.Ajax.call({data:{action:"llms_av_video_ended",id:t.post_id,nonce:t.nonce},beforeSend:function(){LLMS.Spinner.start(e)},error:function(t,n,o){LLMS.Spinner.stop(e),console.error(t.responseText+" ("+o+" "+n+")"),console.log(t)},success:function(t){LLMS.Spinner.stop(e),null!=t&&t.html&&(e.append(t.html),start_countdown(e))}})}var onPauseVideo=function(e){var t=e.detail.plyr,n=getEventMeta(t);track_event("paused",n)},onPlayingVideo=function(e){var t=e.detail.plyr,n=getEventMeta(t),o=n.ts<1?"started":"played";track_event(o,n)},onEndedVideo=function(e,t,n){var o=e.detail.plyr,l=getEventMeta(o);track_event("ended",l),do_ajax_completion(t,n),toggle_mark_complete(!0)};function lifter(e){var t,n,o={},l=(null===(t=llms)||void 0===t||null===(n=t.tracking)||void 0===n?void 0:n.getSettings())||null;null!=l&&l.av&&(o=l.av),o.require_video_completion&&!o.video_completed&&toggle_mark_complete(!1);var a=jQuery(".presto-block-video");e.on("pause",onPauseVideo),e.on("playing",onPlayingVideo),e.on("ended",(function(e){return onEndedVideo(e,a,o)}))}exports.default=lifter,exports.onEndedVideo=onEndedVideo,exports.onPauseVideo=onPauseVideo,exports.onPlayingVideo=onPlayingVideo;
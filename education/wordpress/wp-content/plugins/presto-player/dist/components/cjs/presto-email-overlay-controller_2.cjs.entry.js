"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const index=require("./index-ffe3057f.js"),util=require("./util-efe303f1.js"),fittext=require("./fittext-6c79bcba.js"),prestoEmailOverlayControllerCss=":host{display:block}",PrestoEmailOverlayController=class{constructor(i){index.registerInstance(this,i),this.playVideo=index.createEvent(this,"playVideo",7),this.pauseVideo=index.createEvent(this,"pauseVideo",7),this.restartVideo=index.createEvent(this,"restartVideo",7),this.emailStateChange=index.createEvent(this,"emailStateChange",7),this.ended=void 0,this.currentTime=void 0,this.duration=void 0,this.direction=void 0,this.emailCollection=void 0,this.i18n=void 0,this.videoId=void 0,this.presetId=void 0,this.provider=void 0,this.enabled=void 0,this.show=void 0,this.loading=void 0,this.error=void 0,this.percentagePassed=0}setStorage(i){window.localStorage.setItem("presto.videos.email_collection",JSON.stringify({[this.videoId]:i}))}getStorage(){return window.localStorage.getItem("presto.videos.email_collection")}componentWillLoad(){this.handleDuration()}handleDuration(){var i;this.enabled=!this.getStorage()&&(null===(i=null==this?void 0:this.emailCollection)||void 0===i?void 0:i.enabled),this.handleTimeCheck()}handleTimeCheck(){this.enabled&&(this.getStorage()||this.checkTime())}handleShowChange(){this.show&&this.pauseVideo.emit(!0)}checkTime(){var i;this.show=util.timePassed({current:this.currentTime,duration:this.duration,showAfter:(null===(i=null==this?void 0:this.emailCollection)||void 0===i?void 0:i.percentage)||0})}async getNonce(){var i;return fetch(`${null===(i=null===window||void 0===window?void 0:window.prestoPlayer)||void 0===i?void 0:i.ajaxurl}?action=presto_refresh_progress_nonce`)}async submit(i){var e;this.loading=!0,this.error="";const t=await this.getNonce(),{data:o}=await t.json();try{let t=await fetch(null===(e=null===window||void 0===window?void 0:window.prestoPlayer)||void 0===e?void 0:e.ajaxurl,{method:"post",body:new URLSearchParams(Object.assign({action:"presto_player_email_submit",nonce:o,preset_id:this.presetId,video_id:this.videoId,provider:this.provider},(null==i?void 0:i.detail)||{}))});const{success:r,data:s}=await t.json();if(!r)throw s;this.setStorage("collected"),this.show=!1,this.playVideo.emit()}catch(i){const e=null==i?void 0:i[0];e&&"string"==typeof e&&(this.error=e)}finally{this.loading=!1}}skip(){this.setStorage("skipped"),this.show=!1,this.playVideo.emit()}handleEmailStateChange(i){this.emailStateChange.emit(i)}render(){var i,e,t,o,r,s,l,a;if(this.show)return index.h("presto-email-overlay-ui",{style:Object.assign(Object.assign({},(null===(i=null==this?void 0:this.emailCollection)||void 0===i?void 0:i.button_color)?{"--presto-player-button-color":`${null===(e=null==this?void 0:this.emailCollection)||void 0===e?void 0:e.button_color}`}:{}),(null===(t=null==this?void 0:this.emailCollection)||void 0===t?void 0:t.button_text_color)?{"--presto-player-button-text":`${null===(o=null==this?void 0:this.emailCollection)||void 0===o?void 0:o.button_text_color}`}:{}),direction:this.direction,class:"email-overlay",headline:null===(r=null==this?void 0:this.emailCollection)||void 0===r?void 0:r.headline,bottomText:null===(s=null==this?void 0:this.emailCollection)||void 0===s?void 0:s.bottom_text,allowSkip:null===(l=null==this?void 0:this.emailCollection)||void 0===l?void 0:l.allow_skip,buttonText:null===(a=null==this?void 0:this.emailCollection)||void 0===a?void 0:a.button_text,isLoading:this.loading,errorMessage:this.error,onSubmitForm:i=>this.submit(i),onSkip:()=>this.skip(),i18n:this.i18n,provider:this.provider})}static get watchers(){return{duration:["handleDuration"],currentTime:["handleTimeCheck","handleShowChange"],show:["handleEmailStateChange"]}}};PrestoEmailOverlayController.style=":host{display:block}";const prestoEmailOverlayUiCss=':host{display:block;font-size:16px;width:100%;height:100%;position:absolute;top:0;left:0;bottom:0;right:0;width:100%;height:100%;z-index:99999}*{box-sizing:border-box}a{color:#fff}.overlay{position:relative;display:flex;align-items:center;text-align:center;justify-content:center;padding:48px;color:#fff;font-family:var(--plyr-font-family, "San Francisco", -apple-system, BlinkMacSystemFont, ".SFNSText-Regular", Avenir, "Avenir Next", "Helvetica Neue", "Segoe UI", Helvetica, Arial, sans-serif);height:100%}.overlay:before{content:"";border-radius:var(--presto-player-border-radius, 0);opacity:var(--presto-player-email-background-opacity, 0.75);position:absolute;top:0;left:0;bottom:0;right:0;background-color:var(--presto-player-email-background, #000);z-index:-1;box-shadow:inset 0 0 100px black}.overlay.rtl form{flex-direction:row-reverse}.content{width:20em}form{display:flex;align-items:stretch;justify-content:center}input{background:#fff;border:none;font-size:0.8em;line-height:20px;padding:6px 8px;border-radius:0;border-width:1px;border-style:solid;border-color:transparent;border-radius:var(--presto-player-email-border-radius, 0) 0 0 var(--presto-player-email-border-radius);flex:1}@media screen and (min-width: 700px){input{padding:10px 14px}}input:focus{border-color:var(--plyr-color-main, #000);z-index:1}input:focus,input:hover{outline:none}.rtl input{border-radius:0 var(--presto-player-email-border-radius, 0) var(--presto-player-email-border-radius) 0}button{background-color:var(--presto-player-button-color, var(--plyr-color-main));border-color:var(--presto-player-button-color, var(--plyr-color-main));color:var(--presto-player-button-text, #fff);appearance:none;padding:6px 12px;align-items:center;display:inline-flex;border-width:1px;border-color:transparent;border-radius:0;cursor:pointer;font-size:0.8em;border-radius:0 var(--presto-player-email-border-radius, 0) var(--presto-player-email-border-radius) 0}@media screen and (min-width: 700px){button{padding:10px 18px}}button:focus{box-shadow:white 0px 0px 0px 2px, var(--plyr-color-main, #000) 0px 0px 0px 4px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;z-index:1}button:focus,button:hover{outline:none}.rtl button{border-radius:var(--presto-player-email-border-radius, 0) 0 0 var(--presto-player-email-border-radius)}h1{font-size:1.5em;font-weight:500;margin:0 0 22px 0;max-width:600px;line-height:1.1em}h1.is-small{margin-bottom:1em;font-size:1.1em}.skip{font-size:0.8em;font-weight:600;position:absolute;top:0;right:0;padding:4%;cursor:pointer}p{font-size:0.7em;margin:0;margin-top:1.5em}p.is-small{font-size:0.9em;margin-top:1em}',EmailOverlayUI=class{constructor(i){index.registerInstance(this,i),this.submitForm=index.createEvent(this,"submitForm",7),this.skip=index.createEvent(this,"skip",7),this.headline=void 0,this.bottomText=void 0,this.buttonText=void 0,this.allowSkip=void 0,this.borderRadius=void 0,this.isLoading=void 0,this.errorMessage=void 0,this.direction=void 0,this.i18n=void 0,this.provider=void 0,this.type=void 0,this.email=void 0,this.isAudioProvider=void 0}handleSubmit(i){this.submitForm.emit({email:this.email}),i.preventDefault()}componentDidLoad(){let i=this.type||this.provider;this.isAudioProvider="audio"===i,fittext.fitText(this.textInput,3,{maxFontSize:this.isAudioProvider?15:20,minFontSize:8})}handleChange(i){this.email=i.target.value}render(){var i,e,t,o;return index.h("div",{class:"overlay "+("rtl"===this.direction?"rtl":""),ref:i=>this.textInput=i},index.h("div",{class:"content"},index.h("h1",{class:this.isAudioProvider&&"is-small"},this.headline||(null===(i=null==this?void 0:this.i18n)||void 0===i?void 0:i.emailDefaultHeadline)),this.isLoading?index.h("presto-player-spinner",null):index.h("form",{onSubmit:i=>this.handleSubmit(i)},index.h("input",{type:"email",placeholder:null===(e=null==this?void 0:this.i18n)||void 0===e?void 0:e.emailPlaceholder,value:this.email,onInput:i=>this.handleChange(i),required:!0}),index.h("button",{type:"submit"},this.buttonText||(null===(t=null==this?void 0:this.i18n)||void 0===t?void 0:t.play))),this.errorMessage&&index.h("p",{class:"error"},this.errorMessage),this.bottomText&&index.h("p",{innerHTML:this.bottomText,class:this.isAudioProvider&&"is-small"}),!!this.allowSkip&&index.h("div",{class:"skip",onClick:()=>{this.skip.emit()}},null===(o=null==this?void 0:this.i18n)||void 0===o?void 0:o.skip," â†’")))}};EmailOverlayUI.style=prestoEmailOverlayUiCss,exports.presto_email_overlay_controller=PrestoEmailOverlayController,exports.presto_email_overlay_ui=EmailOverlayUI;
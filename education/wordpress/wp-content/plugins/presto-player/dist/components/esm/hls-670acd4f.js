import{k as _asyncToGenerator,l as _regeneratorRuntime,a as _objectSpread2}from"./index-eaf5bc58.js";import{P as PrestoPlayer}from"./presto-player-72a3bbad.js";import"./util-7edc682d.js";import"./cache-cues-1c3cd164.js";var loadHLS=function(e){var r=e.config,t=e.selector,n=e.src,a=e.preload;return new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(o,i){var s,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.Hls){e.next=6;break}case 1:if(window.hasOwnProperty("Hls")){e.next=6;break}return e.next=4,new Promise((function(e){return setTimeout(e,50)}));case 4:e.next=1;break;case 6:if(!window.Hls.isSupported()){e.next=16;break}return u=!["metadata","none"].includes(a),null!==(s=wp)&&void 0!==s&&s.blocks&&(u=!0),(l=new window.Hls({autoStartLoad:u})).loadSource(n),l.on(window.Hls.Events.LEVEL_SWITCHED,(function(e,r){var n=t.closest(".presto-player__wrapper").querySelector(".plyr__menu__container [data-plyr='quality'][value='0'] span");l.autoLevelEnabled?n.innerHTML="AUTO (".concat(l.levels[r.level].height,"p)"):n.innerHTML="AUTO"})),l.on(window.Hls.Events.MANIFEST_PARSED,(function(e,n){var a=l.levels.map((function(e){return e.height}));a.unshift(0);var i=a.findIndex((function(e){var r;return e===parseInt(null===(r=prestoPlayer)||void 0===r?void 0:r.hls_start_level)}));l.startLevel=i?i-1:2,r.quality={default:0,options:a,forced:!0,onChange:function(e){0===e?prestoHLS.currentLevel=-1:prestoHLS.levels.forEach((function(r,t){r.height===e&&(console.log("Found quality match with "+e),prestoHLS.currentLevel=t)}))}},l.attachMedia(t),window.prestoHLS=l;var s=new PrestoPlayer(t,_objectSpread2({},r));return s.hls=l,s.on("waiting",(function e(){l.startLoad(-1),s.off("waiting",e)})),s.on("languagechange",(function(){setTimeout((function(){return l.subtitleTrack=s.currentTrack}),50)})),o(s)})),e.abrupt("return");case 16:if(!t.canPlayType("application/vnd.apple.mpegurl")){e.next=18;break}return e.abrupt("return",o(new PrestoPlayer(t,_objectSpread2({},r))));case 18:return e.abrupt("return",o(new PrestoPlayer(t,_objectSpread2({},r))));case 19:case"end":return e.stop()}}),e)})));return function(_x,r){return e.apply(this,arguments)}}())};export default loadHLS;